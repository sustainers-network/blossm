name: add-roles
domain: principal
service: core

payload:
  roles:
    - id: string
      root: string
      service: string
      network:
        type: domain
        in: $aud
          
devDependencies:
  "mocha": "^7.1.0"
  "chai": "^4.2.0"
  "sinon": "^7.3.2"
  "sinon-chai": "^3.3.0"
  "chai-datetime": "^1.5.0"

testing:
  validate:
    aud: some.network,some.other-network
    ok:
      - roles:
          - id: some-id
            root: some-root
            service: some-service
            network: some.network
    bad:
      - roles:
          a: 1
      - roles:
          - id: 3
      - roles:
          - root: 3
      - roles:
          - service: 3
      - roles:
          - id: some-id
            root: some-root
            service: some-service
            network: some.whack-network
      - roles:
          - id: some-id
            root: some-root
            service: some-service
            network: some-whack-network

  normalize:
    - payload:
        roles:
          - id: some-id
            root: some-root
            service: some-service
      normalized:
        roles:
          - id: some-id
            root: some-root
            service: some-service

  dependencies:

  steps:
    - payload:
        roles:
          - id: some-role-id
            root: some-role-root
            service: some-role-service
            network: some.role-network
      claims:
        aud: some.role-network
      context:
        network: some-network
      root: some-root
      code: 202
    - payload:
        roles:
          - id: some-other-role-id
            root: some-role-root
            service: some-role-service
            network: some.role-network
      claims:
        aud: some.role-network
      context: {}
      root: some-root
      code: 202

#don't change
procedure: command
