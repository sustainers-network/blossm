name: push
domain: updates
service: system

payload:
  view:
    headers: object
    body: object
  channel: string

dependencies:
  "grip": "*"
  "faas-grip": "*"
  "@blossm/uuid": "*"
  "@blossm/gcp-secret": "*"

devDependencies:
  "mocha": "^7.1.1"
  "chai": "^4.2.0"
  "sinon": "^7.3.2"
  "sinon-chai": "^3.5.0"
  "chai-datetime": "^1.5.0"

testing:
  dependencies:
    - procedure: http
      host: api.fanout.io
      mocks:
        - method: post
          path: "*"
          code: 200
          response: some-channel

  validate:
    ok:
      - view:
          headers:
            some: header
          body:
            some: property
        channel: some-channel
    bad:
      - view: 3
      - view:
          headers: 3
      - view:
          body: 3
      - channel: 3

  normalize:
    - payload:
        view:
          headers: some-headers
          body: some-body
          other: som-bogus
        channel: some-channel
      normalized:
        view:
          headers: some-headers
          body: some-body
        channel: some-channel

  steps:
    - payload:
        view:
          headers:
            a: 1
          body:
            b: 2
        channel: some-channel
      context:
        node:
          root: some-node-root
          service: some-node-service
          network: some-node-network
        connection:
          root: some-connection-root
          service: some-connection-service
          network: some-connection-network
        key:
          root: some-key-root
          service: some-key-service
          network: some-key-network
      code: 202

#don't change
procedure: command
